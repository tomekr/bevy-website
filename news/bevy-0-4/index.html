







<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name='viewport' content="width=device-width, initial-scale=1" />
        <meta property="og:title" content="Bevy - Bevy 0.4" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://bevyengine.org&#x2F;&#x2F;news&#x2F;bevy-0-4&#x2F;" />
        <meta property="og:image" content="https://bevyengine.org/assets/bevy_logo_fill.png" />
        <meta property="og:description" content="Bevy is a refreshingly simple data-driven game engine built in Rust. It is free and open-source forever!" />
        <link rel="shortcut icon" type="image/png" href="/assets/favicon.png">
        <link rel="stylesheet" href="/site.css" />
        <link href="/atom.xml" rel="alternate" type="application/atom+xml" />
        <title>Bevy - Bevy 0.4</title>
         
    </head>

    <body>
        <div class="headerbar-container">
            <nav class="headerbar container">
                <a href="/" class="header-logo">
                    <img src="/assets/bevy_logo_dark.svg" class="logo" alt="bevy logo" />
                </a>
                
                    <a href="/" class="header-logo-mobile">
                        <img src="/assets/bevy_icon_dark.svg" class="logo" alt="bevy icon" />
                    </a>
                
                <div class="header-item header-message">
                    
                        News
                    
                </div>
                <div class="header-item header-push"></div>
                



    


<a href="&#x2F;" class="header-item" >
    Features
</a>

                



    


<a href="&#x2F;learn" class="header-item" >
    Learn
</a>

                



    


<a href="&#x2F;news" class="header-item header-item-active"  >
    News
</a>

                



    


<a href="&#x2F;community" class="header-item" >
    Community
</a>

                <a class="header-item header-button header-button-donate" href="https://github.com/sponsors/cart">Donate <img src="/assets/heart.svg" class="header-button-donate-heart" alt="heart icon"/></a>
                <a class="header-item header-button" href="/learn/book/getting-started/">Get Started</a>
            </nav>
        </div>
        <section class="section">
            <div class="container">
                
<div class="padded-content">
  <h1 class="news-title">
    Bevy 0.4
  </h1>
  <h2 class="news-subtitle">Written on December 19, 2020 by Carter Anderson
    
    <span class="news-social-links">
      (
      
      <img src="/assets/github_grey.svg" class="news-social-icon" /><span class="media-content">
        <a class="news-social-link"
          href="https://www.github.com/cart">@cart</a></span>
      
      
      <img src="/assets/twitter_grey.svg" class="news-social-icon" />
      <span class="media-content">
        <a class="news-social-link"
          href="https://www.twitter.com/cart_cart">@cart_cart</a>
      </span>
      
      
      <img src="/assets/youtube_grey.svg" class="news-social-icon" />
      <span class="media-content">
        <a class="news-social-link"
          href="https://www.youtube.com/cartdev">cartdev</a>
      </span>
      
      )
    </span>
    
  </h2>
  
  <div class="media-content news-content">
    <img src="colonize.png" />
    
      
      <div class="news-image-subtitle"><a href="https:&#x2F;&#x2F;github.com&#x2F;indiv0&#x2F;colonize&#x2F;">Screenshot of Colonize: a Dwarf-Fortress&#x2F;Rimworld-like game being developed in Bevy by @indiv0</a></div>
      
    
  </div>
  
  <div class="media-content news-content"><p>A little over a month after releasing Bevy 0.3, and thanks to <strong>66</strong> contributors, <strong>178</strong> pull requests, and our <a href="https://github.com/sponsors/cart"><strong>generous sponsors</strong></a>, I'm happy to announce the <strong>Bevy 0.4</strong> release on <a href="https://crates.io/crates/bevy">crates.io</a>!</p>
<p>For those who don't know, Bevy is a refreshingly simple data-driven game engine built in Rust. You can check out <a href="/learn/book/getting-started/">Quick Start Guide</a> to get started. Bevy is also free and open source forever! You can grab the full <a href="https://github.com/bevyengine/bevy">source code</a> on GitHub.</p>
<p>Here are some of the highlights from this release:</p>
<span id="continue-reading"></span><h2 id="wasm-webgl2">WASM + WebGL2</h2>
<div class="release-feature-authors">authors: @mrk-its</div>
<p>Bevy now has a WebGL2 render backend! @mrk-its has been hard at work building the <a href="https://github.com/mrk-its/bevy_webgl2">Bevy WebGL2 Plugin</a> and expanding <code>bevy_render</code> to meet the needs of the web. He also put together a nice website showcasing various Bevy examples and games running on the web. </p>
<p>I think the results speak for themselves:</p>
<h3 id="bevy-webgl2-showcase"><a href="https://mrk.sed.pl/bevy-showcase/">Bevy WebGL2 Showcase</a></h3>
<p><a href="https://mrk.sed.pl/bevy-showcase/"><img src="https://bevyengine.org/news/bevy-0-4/webgl_showcase.png" alt="webgl2 showcase" /></a></p>
<h2 id="cross-platform-main-function">Cross Platform Main Function</h2>
<div class="release-feature-authors">authors: @cart</div>
<p>On most supported Bevy platforms you can just use normal main functions (ex: Windows, MacOS, Linux, and Web). Here is the smallest possible Bevy app that runs on those platforms:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">use </span><span style="color:#cccece;">bevy</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">prelude</span><span style="color:#5fb3b3;">::*;

</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
    </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">().</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
}
</span></code></pre>
<p>However some platforms (currently Android and iOS) require additional boilerplate. This arcane magic is error prone, takes up space, and isn't particularly nice to look at. Up until this point, Bevy users had to supply their own boilerplate ... but no more! <strong>Bevy 0.4</strong> adds a new <code>#[bevy_main]</code> proc-macro, which inserts the relevant boilerplate for you. This is a big step toward our &quot;write once run anywhere&quot; goal.</p>
<p>This Bevy App has all the code required to run on Windows, MacOS, Linux, Android, iOS, and Web:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">use </span><span style="color:#cccece;">bevy</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">prelude</span><span style="color:#5fb3b3;">::*;

#[</span><span style="color:#cccece;">bevy_main</span><span style="color:#5fb3b3;">]
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
    </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">().</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
}
</span></code></pre><h2 id="live-shader-reloading">Live Shader Reloading</h2>
<div class="release-feature-authors">authors: @yrns</div>
<p>Bevy can now update changes to shaders at runtime, giving you instant feedback without restarting your app. This video isn't sped up!</p>
<p><video controls loop><source  src="hot_shader_reloading.mp4" type="video/mp4"/></video></p>
<h2 id="ecs-improvements">ECS Improvements</h2>
<div class="release-feature-authors">authors: @cart</div>
<p>It wouldn't be a Bevy update without another round of ECS improvements!</p>
<h3 id="flexible-ecs-parameters">Flexible ECS Parameters</h3>
<p>Prior versions of Bevy forced you to provide system parameters in a specific order:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">/// This system followed the [Commands][Resources][Queries] order and compiled as expected
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">valid_system</span><span style="color:#5fb3b3;">(</span><span style="color:#c594c5;">mut </span><span style="color:#f99157;">commands</span><span style="color:#5fb3b3;">:</span><span style="color:#cccece;"> Commands, </span><span style="color:#f99157;">time</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Time</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, </span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;&amp;</span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">&gt;) {
}

</span><span style="color:#5f6364;">/// This system did not follow the required ordering, which caused compilation to fail
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">invalid_system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;&amp;</span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, </span><span style="color:#c594c5;">mut </span><span style="color:#f99157;">commands</span><span style="color:#5fb3b3;">:</span><span style="color:#cccece;"> Commands, </span><span style="color:#f99157;">time</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Time</span><span style="color:#5fb3b3;">&gt;) {
}
</span></code></pre>
<p>Newbies would fall prey to this constantly. These completely arbitrary constraints were a quirk of the internal implementation. The <code>IntoSystem</code> trait was only implemented for specific orders. Supporting every order would have exponentially affected compile times. The internal implementation was also constructed with a <a href="https://github.com/bevyengine/bevy/blob/9afe196f1690a6a6e47bf67ac740b4edeffd97bd/crates/bevy_ecs/src/system/into_system.rs#L158">famously complicated macro</a>.</p>
<p>To resolve this, I completely rewrote how we generate systems. We now use a <code>SystemParam</code> trait, which we implement for each parameter type. This has a number of benefits:</p>
<ul>
<li><strong>Significantly Faster Compile Times</strong>: We're seeing a <b style="color: rgb(50, 210, 50)">~25%</b> decrease in clean compile times</li>
<li><strong>Use Any Parameter Order You Want</strong>: No more arbitrary order restrictions!</li>
<li><strong>Easily Add New Parameters</strong>: It is now easy for us (and for users) to create new parameters. Just implement the <code>SystemParam</code> trait!</li>
<li><strong>Simpler Implementation</strong>: The new implementation is much smaller and also way easier to maintain and understand.</li>
</ul>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// In Bevy 0.4 this system is now perfectly valid. Cool!
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;&amp;</span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, </span><span style="color:#f99157;">commands</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> Commands, </span><span style="color:#f99157;">time</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Time</span><span style="color:#5fb3b3;">&gt;) {
}
</span></code></pre>
<p>Notice that in <strong>Bevy 0.4</strong>, commands now look like <code>commands: &amp;mut Commands</code> instead of <code>mut commands: Commands</code>. </p>
<h3 id="simplified-query-filters">Simplified Query Filters</h3>
<p>Up until now, Bevy's Query filters were intermingled with components:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">With</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">A, Without</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">B, </span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">Transform, Changed</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Velocity</span><span style="color:#5fb3b3;">&gt;)&gt;&gt;&gt;) {
}
</span></code></pre>
<p>Confused? You wouldn't be the first! You can interpret the query above as &quot;give me immutable references to the <code>Transform</code> and <code>Velocity</code> components of all entities that have the <code>A</code> component, <em>do not</em> have the <code>B</code> component, and have a changed Velocity component&quot;.</p>
<p>First, the nesting of types via With / Without makes it very unclear whats going on. Additionally, it's hard to tell what the <code>Changed&lt;Velocity&gt;</code> parameter does. Is it just a filter? Does it also return a Velocity component? If so, is it immutable or mutable?</p>
<p>It made sense to break up these concepts. In <strong>Bevy 0.4</strong>, Query filters are separate from Query components. The query above looks like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// Query with filters
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;(&amp;</span><span style="color:#cccece;">Transform, </span><span style="color:#5fb3b3;">&amp;</span><span style="color:#cccece;">Velocity</span><span style="color:#5fb3b3;">)</span><span style="color:#cccece;">, </span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">With</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">A</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, Without</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">B</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, Changed</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Velocity</span><span style="color:#5fb3b3;">&gt;)&gt;) {
}

</span><span style="color:#5f6364;">// Query without filters
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;(&amp;</span><span style="color:#cccece;">Transform, </span><span style="color:#5fb3b3;">&amp;</span><span style="color:#cccece;">Velocity</span><span style="color:#5fb3b3;">)&gt;) {
}
</span></code></pre>
<p>This makes it much easier to tell what a Query is doing at a glance. It also makes for more composable behaviors. For example, you can now filter on <code>Changed&lt;Velocity&gt;</code> without actually retrieving the <code>Velocity</code> component.</p>
<p>And now that filters are a separate type, you can create type aliases for filters that you want to re-use:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">type </span><span style="color:#cccece;">ChangedVelocity </span><span style="color:#5fb3b3;">= (</span><span style="color:#cccece;">With</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">A</span><span style="color:#5fb3b3;">&gt;, </span><span style="color:#cccece;">Without</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">B</span><span style="color:#5fb3b3;">&gt;, </span><span style="color:#cccece;">Changed</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Velocity</span><span style="color:#5fb3b3;">&gt;);

</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;(&amp;</span><span style="color:#cccece;">Transform, </span><span style="color:#5fb3b3;">&amp;</span><span style="color:#cccece;">Velocity</span><span style="color:#5fb3b3;">)</span><span style="color:#cccece;">, ChangedVelocity</span><span style="color:#5fb3b3;">&gt;) {
}
</span></code></pre><h3 id="system-inputs-outputs-and-chaining">System Inputs, Outputs, and Chaining</h3>
<p>Systems can now have inputs and outputs. This opens up a variety of interesting behaviors, such as system error handling:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
  </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">()
    .</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">result_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">().</span><span style="color:#6699cc;">chain</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">error_handler</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">()))
    .</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
}

</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">result_system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;&amp;</span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">&gt;) -&gt; </span><span style="color:#fac863;">Result</span><span style="color:#5fb3b3;">&lt;()&gt; {
  </span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> transform </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> query</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">get</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">SOME_ENTITY</span><span style="color:#5fb3b3;">)?;
  </span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">found entity transform: {:?}</span><span style="color:#5fb3b3;">&quot;,</span><span style="color:#cccece;"> transform</span><span style="color:#5fb3b3;">);
  </span><span style="color:#fac863;">Ok</span><span style="color:#5fb3b3;">(())
}

</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">error_handler_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">In</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">result</span><span style="color:#5fb3b3;">)</span><span style="color:#cccece;">: In</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#fac863;">Result</span><span style="color:#5fb3b3;">&lt;()&gt;&gt;</span><span style="color:#cccece;">, </span><span style="color:#f99157;">error_handler</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">MyErrorHandler</span><span style="color:#5fb3b3;">&gt;) {
  </span><span style="color:#c594c5;">if let </span><span style="color:#fac863;">Err</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">err</span><span style="color:#5fb3b3;">) =</span><span style="color:#cccece;"> result </span><span style="color:#5fb3b3;">{
</span><span style="color:#cccece;">      error_handler</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">handle_error</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">err</span><span style="color:#5fb3b3;">);
  }
}
</span></code></pre>
<p>The <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/trait.System.html"><code>System</code>
</a> trait now looks like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// Has no inputs and no outputs
</span><span style="color:#cccece;">System</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">In = </span><span style="color:#5fb3b3;">()</span><span style="color:#cccece;">, Out = </span><span style="color:#5fb3b3;">()&gt;

</span><span style="color:#5f6364;">// Takes a usize as input and return a f32
</span><span style="color:#cccece;">System</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">In = </span><span style="color:#c594c5;">usize</span><span style="color:#cccece;">, Out = </span><span style="color:#c594c5;">f32</span><span style="color:#5fb3b3;">&gt;
</span></code></pre>
<p>We use this feature in our new Schedule implementation.</p>
<h3 id="schedule-v2">Schedule V2</h3>
<p>Bevy's old Schedule was nice. System registrations were easy to read and easy to compose. But it also had significant limitations:</p>
<ul>
<li>Only one Schedule allowed</li>
<li>Very static: you were limited to using the tools we gave you:
<ul>
<li>stages are just lists of systems</li>
<li>stages are added to schedules</li>
<li>stages use hard-coded system runners</li>
</ul>
</li>
<li>Couldn't switch between schedules at runtime</li>
<li>Couldn't easily support &quot;fixed timestep&quot; scenarios</li>
</ul>
<p>To solve these problems, I wrote a new Schedule system from scratch. Before you get worried, these are largely <em>non-breaking</em> changes. The high level &quot;app builder&quot; syntax you know and love is still available:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">app</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">my_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span></code></pre><h4 id="stage-trait">Stage Trait</h4>
<p>Stages are now a trait. You can now implement your own <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/trait.Stage.html"><code>Stage</code>
</a> types!</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">struct </span><span style="color:#cccece;">MyStage</span><span style="color:#5fb3b3;">;

</span><span style="color:#c594c5;">impl </span><span style="color:#cccece;">Stage </span><span style="color:#c594c5;">for </span><span style="color:#cccece;">MyStage </span><span style="color:#5fb3b3;">{
    </span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#c594c5;">mut </span><span style="color:#f99157;">self</span><span style="color:#cccece;">, </span><span style="color:#f99157;">world</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> World, </span><span style="color:#f99157;">resources</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> Resources</span><span style="color:#5fb3b3;">) {
        </span><span style="color:#5f6364;">// Do stage stuff here.
        // You have unique access to the World and Resources, so you are free to do anything
    </span><span style="color:#5fb3b3;">}
}
</span></code></pre><h4 id="stage-type-systemstage">Stage Type: <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/struct.SystemStage.html"><code>SystemStage</code></h4>
<p></a></p>
<p>This is basically a &quot;normal&quot; stage. You can add systems to it and you can decide how those systems will be executed (parallel, serial, or custom logic)</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// runs systems in parallel (using the default parallel executor)
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> parallel_stage </span><span style="color:#5fb3b3;">=
    </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">parallel</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">b</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">());

</span><span style="color:#5f6364;">// runs systems serially (in registration order)
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> serial_stage </span><span style="color:#5fb3b3;">=
    </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">serial</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">b</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">());

</span><span style="color:#5f6364;">// you can also write your own custom SystemStageExecutor
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> custom_executor_stage </span><span style="color:#5fb3b3;">=
    </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">MyCustomExecutor</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">b</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">());
</span></code></pre><h4 id="stage-type-schedule">Stage Type: <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/struct.Schedule.html"><code>Schedule</code></h4>
<p></a></p>
<p>You read that right! <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/struct.Schedule.html"><code>Schedule</code>
</a> now implements the <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/trait.Stage.html"><code>Stage</code>
</a> trait, which means you can nest Schedules within other schedules:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">let</span><span style="color:#cccece;"> schedule </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">Schedule</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">()
    .</span><span style="color:#6699cc;">with_stage</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">update</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">parallel</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">b</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    )
    .</span><span style="color:#6699cc;">with_stage</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">nested</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">Schedule</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">with_stage</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">nested_stage</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">serial</span><span style="color:#5fb3b3;">()
            .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">b</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        )
    );
</span></code></pre><h4 id="run-criteria">Run Criteria</h4>
<p>You can add &quot;run criteria&quot; to any <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/struct.SystemStage.html"><code>SystemStage</code>
</a> or <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/struct.Schedule.html"><code>Schedule</code>
</a>.</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// A &quot;run criteria&quot; is just a system that returns a `ShouldRun` result
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">only_on_10_criteria</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">value</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#c594c5;">usize</span><span style="color:#5fb3b3;">&gt;) -&gt;</span><span style="color:#cccece;"> ShouldRun </span><span style="color:#5fb3b3;">{
    </span><span style="color:#c594c5;">if </span><span style="color:#5fb3b3;">*</span><span style="color:#cccece;">value </span><span style="color:#5fb3b3;">== </span><span style="color:#f99157;">10 </span><span style="color:#5fb3b3;">{ 
        </span><span style="color:#cccece;">ShouldRun</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">Yes 
    </span><span style="color:#5fb3b3;">} </span><span style="color:#c594c5;">else </span><span style="color:#5fb3b3;">{ 
        </span><span style="color:#cccece;">ShouldRun</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">No
    </span><span style="color:#5fb3b3;">}
}

</span><span style="color:#cccece;">app
    </span><span style="color:#5f6364;">// this stage only runs when Res&lt;usize&gt; has a value of 10
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_stage_after</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">UPDATE</span><span style="color:#5fb3b3;">, &quot;</span><span style="color:#99c794;">only_on_10_stage</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">parallel</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">with_run_criteria</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">only_on_10_criteria</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">my_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    )
    </span><span style="color:#5f6364;">// this stage only runs once
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_stage_after</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">RUN_ONCE</span><span style="color:#5fb3b3;">, &quot;</span><span style="color:#99c794;">one_and_done</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">Schedule</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">with_run_criteria</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">RunOnce</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">my_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    )
</span></code></pre><h4 id="fixed-timestep">Fixed Timestep</h4>
<p>You can now run stages on a &quot;fixed timestep&quot;.</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// this stage will run once every 0.4 seconds
</span><span style="color:#cccece;">app</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_stage_after</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">UPDATE</span><span style="color:#5fb3b3;">, &quot;</span><span style="color:#99c794;">fixed_update</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">SystemStage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">parallel</span><span style="color:#5fb3b3;">()
    .</span><span style="color:#6699cc;">with_run_criteria</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">FixedTimestep</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">step</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">0.4</span><span style="color:#5fb3b3;">))
    .</span><span style="color:#6699cc;">with_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">my_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
)
</span></code></pre>
<p>This builds on top of <code>ShouldRun::YesAndLoop</code>, which ensures that the schedule continues to loop until it has consumed all accumulated time.</p>
<p>Check out the excellent <a href="https://gafferongames.com/post/fix_your_timestep/">&quot;Fix Your Timestep!&quot;</a> article if you want to learn more about fixed timesteps.</p>
<h4 id="typed-stage-builders">Typed Stage Builders</h4>
<p>Now that stages can be any type, we need a way for <a href="https:&#x2F;&#x2F;docs.rs/bevy_app&#x2F;0.4.0&#x2F;bevy_app/trait.Plugin.html"><code>Plugins</code>
</a> to interact with arbitrary stage types:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">app
    </span><span style="color:#5f6364;">// this &quot;high level&quot; builder pattern still works (and assumes that the stage is a SystemStage)
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">some_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    </span><span style="color:#5f6364;">// this &quot;low level&quot; builder is equivalent to add_system()
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">stage</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">UPDATE</span><span style="color:#5fb3b3;">, |</span><span style="color:#f99157;">stage</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> SystemStage</span><span style="color:#5fb3b3;">|
        </span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">some_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    )
    </span><span style="color:#5f6364;">// this works for custom stage types too
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">stage</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">MY_CUSTOM_STAGE</span><span style="color:#5fb3b3;">, |</span><span style="color:#f99157;">stage</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> MyCustomStage</span><span style="color:#5fb3b3;">|
        </span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">do_custom_thing</span><span style="color:#5fb3b3;">()
    )
</span></code></pre><h3 id="deprecated-for-each-systems">Deprecated For-Each Systems</h3>
<p>Prior versions of Bevy supported &quot;for-each&quot; systems, which looked like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// on each update this system runs once for each entity with a Transform component
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">time</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Time</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, </span><span style="color:#f99157;">entity</span><span style="color:#5fb3b3;">:</span><span style="color:#cccece;"> Entity, </span><span style="color:#f99157;">transform</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Mut</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">&gt;) {
    </span><span style="color:#5f6364;">// do per-entity logic here
</span><span style="color:#5fb3b3;">}
</span></code></pre>
<p>From now on, the system above should be written like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// on each update this system runs once and internally iterates over each entity
</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">time</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Time</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, </span><span style="color:#f99157;">query</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Query</span><span style="color:#5fb3b3;">&lt;(</span><span style="color:#cccece;">Entity, </span><span style="color:#5fb3b3;">&amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> Transform</span><span style="color:#5fb3b3;">)&gt;) {
    </span><span style="color:#c594c5;">for </span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">entity</span><span style="color:#5fb3b3;">, </span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> transform</span><span style="color:#5fb3b3;">) in</span><span style="color:#cccece;"> query</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">iter_mut</span><span style="color:#5fb3b3;">() {
        </span><span style="color:#5f6364;">// do per-entity logic here
    </span><span style="color:#5fb3b3;">}
}
</span></code></pre>
<p>For-each systems were nice to look at and sometimes saved some typing. Why remove them?</p>
<ol>
<li>For-each systems were fundamentally limited in a number of ways. They couldn't iterate removed components, filter, control iteration, or use multiple queries at the same time. This meant they needed to be converted to &quot;query systems&quot; as soon as those features were needed.</li>
<li>Bevy should generally have &quot;one way to do things&quot;. For-each systems were a slightly more ergonomic way to define a small subset of system types. This forced people to make a &quot;design decision&quot; when they shouldn't need to. It also made examples and tutorials inconsistent according to people's preferences for one or the other.</li>
<li>There were a number of &quot;gotchas&quot; for newcomers that constantly come up in our support forums and confused newbies:
<ul>
<li>users expect <code>&amp;mut T</code> queries to work in foreach systems (ex: <code>fn system(a: &amp;mut A) {}</code>). These can't work because we require <code>Mut&lt;T&gt;</code> tracking pointers to ensure change tracking always works as expected. The equivalent <code>Query&lt;&amp;mut A&gt;</code> works because we can return the tracking pointer when iterating the Query.</li>
<li>A &quot;run this for-each system on some criteria&quot; bug that was common enough that we had to cover it in the Bevy Book.</li>
</ul>
</li>
<li>They increased compile times. Removing for-each systems saved me about ~5 seconds on clean Bevy compiles)</li>
<li>Their internal implementation required a complicated macro. This affected maintainability.</li>
</ol>
<h2 id="states">States</h2>
<div class="release-feature-authors">authors: @cart</div>
<p>By popular demand, Bevy now supports States. These are logical &quot;app states&quot; that allow you to enable/disable systems according to the state your app is in.</p>
<p>States are defined as normal Rust enums:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5fb3b3;">#[</span><span style="color:#cccece;">derive</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">Clone</span><span style="color:#5fb3b3;">)]
</span><span style="color:#c594c5;">enum </span><span style="color:#cccece;">AppState </span><span style="color:#5fb3b3;">{
</span><span style="color:#cccece;">    Loading</span><span style="color:#5fb3b3;">,
</span><span style="color:#cccece;">    Menu</span><span style="color:#5fb3b3;">,
</span><span style="color:#cccece;">    InGame
</span><span style="color:#5fb3b3;">}
</span></code></pre>
<p>You then add them to your app as a resource like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// add a new AppState resource that defaults to the Loading state
</span><span style="color:#cccece;">app</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_resource</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">State</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">Loading</span><span style="color:#5fb3b3;">))
</span></code></pre>
<p>To run systems according to the current state, add a <a href="https:&#x2F;&#x2F;docs.rs/bevy_ecs&#x2F;0.4.0&#x2F;bevy_ecs/struct.StateStage.html"><code>StateStage</code>
</a>:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">app</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">add_stage_after</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">stage</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">UPDATE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">STAGE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">StateStage</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">&gt;::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">())
</span></code></pre>
<p>You can then add systems for each state value / lifecycle-event like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">app
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">on_state_enter</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">STAGE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">Menu</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> setup_menu</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    .</span><span style="color:#6699cc;">on_state_update</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">STAGE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">Menu</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> menu</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    .</span><span style="color:#6699cc;">on_state_exit</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">STAGE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">Menu</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> cleanup_menu</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    .</span><span style="color:#6699cc;">on_state_enter</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">STAGE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">InGame</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> setup_game</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
    .</span><span style="color:#6699cc;">on_state_update</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">STAGE</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">InGame</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> movement</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
</span></code></pre>
<p>Notice that there are different &quot;lifecycle events&quot;:</p>
<ul>
<li><strong>on_enter</strong>: Runs once when first entering a state</li>
<li><strong>on_exit</strong>: Runs once when exiting a state</li>
<li><strong>on_update</strong>: Runs exactly once on every run of the stage (after any on_enter or on_exit events have been run)</li>
</ul>
<p>You can queue a state change from a system like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">(</span><span style="color:#c594c5;">mut </span><span style="color:#f99157;">state</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">ResMut</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">State</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">&gt;&gt;) {
</span><span style="color:#cccece;">    state</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">set_next</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">AppState</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">InGame</span><span style="color:#5fb3b3;">).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();
}
</span></code></pre>
<p>Queued state changes get applied at the end of the StateStage. If you change state within a StateStage, the lifecycle events will occur in the same update/frame. You can do this any number of times (aka it will continue running state lifecycle systems until no more changes are queued). This ensures that multiple state changes can be applied within the same frame.</p>
<h2 id="gltf-improvements">GLTF Improvements</h2>
<div class="release-feature-authors">authors: @iwikal, @FuriouZz, @rod-salazar</div>
<p>Bevy's GLTF loader now imports Cameras. Here is a simple scene setup in Blender:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/gltf_camera_blender.png" alt="gltf_camera_blender" /></p>
<p>And here is how it looks in Bevy (the lighting is different because we don't import lights yet):</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/gltf_camera_bevy.png" alt="gltf_camera_bevy" /></p>
<p>There were also a number of other improvements:</p>
<ul>
<li>Pixel format conversion while importing images from a GLTF</li>
<li>Default material loading</li>
<li>Hierarchy fixes</li>
</ul>
<h2 id="spawn-scenes-as-children">Spawn Scenes as Children</h2>
<div class="release-feature-authors">authors: @mockersf</div>
<p>Scenes can now be spawned as children like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">commands
    </span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">spawn</span><span style="color:#5fb3b3;">((
        </span><span style="color:#cccece;">Transform</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">from_translation</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">Vec3</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">0.5</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">0.0</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">0.0</span><span style="color:#5fb3b3;">)),
        </span><span style="color:#cccece;">GlobalTransform</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">(),
    ))
    .</span><span style="color:#6699cc;">with_children</span><span style="color:#5fb3b3;">(|</span><span style="color:#f99157;">parent</span><span style="color:#5fb3b3;">| {
</span><span style="color:#cccece;">        parent</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">spawn_scene</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">asset_server</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">load</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">scene.gltf</span><span style="color:#5fb3b3;">&quot;));
    });
</span></code></pre>
<p>By spawning beneath a parent, this enables you to do things like translate/rotate/scale multiple instances of the same scene:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/scene_children.png" alt="scene_children" /></p>
<h2 id="dynamic-linking">Dynamic Linking</h2>
<div class="release-feature-authors">authors: @bjorn3, @cart</div>
<p>@bjorn3 discovered that you can force Bevy to dynamically link.</p>
<p>This <em>significantly</em> reduces iterative compile times. Check out how long it takes to compile a change made to the <code>3d_scene.rs</code> example with the <a href="https://bevyengine.org/learn/book/getting-started/setup/">Fast Compiles Config</a> <em>and</em> dynamic linking:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/dynamic_fast.png" alt="fast dynamic" /></p>
<h3 id="time-to-compile-change-to-3d-scene-example-in-seconds-less-is-better">Time To Compile Change To 3d_scene Example (in seconds, less is better)</h3>
<p><img src="https://bevyengine.org/news/bevy-0-4/fast_compiles.svg" alt="fast_compiles" /></p>
<p>We added a cargo feature to easily enable dynamic linking during development</p>
<pre style="background-color:#2b2c2f;">
<code class="language-sh" data-lang="sh"><span style="color:#5f6364;"># for a bevy app
</span><span style="color:#6699cc;">cargo run</span><span style="color:#5fb3b3;"> --</span><span style="color:#f99157;">features</span><span style="color:#6699cc;"> bevy/dynamic

</span><span style="color:#5f6364;"># for bevy examples
</span><span style="color:#6699cc;">cargo run</span><span style="color:#5fb3b3;"> --</span><span style="color:#f99157;">features</span><span style="color:#6699cc;"> dynamic</span><span style="color:#5fb3b3;"> --</span><span style="color:#f99157;">example</span><span style="color:#6699cc;"> breakout
</span></code></pre>
<p>Just keep in mind that you should disable the feature when publishing your game.</p>
<h2 id="text-layout-improvements">Text Layout Improvements</h2>
<div class="release-feature-authors">authors: @AlisCode, @tigregalis</div>
<p>Prior Bevy releases used a custom, naive text layout system. It had a number of bugs and limitations, such as the infamous &quot;wavy text&quot; bug:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/wavy_text.png" alt="wavy_text" /></p>
<p>The new text layout system uses glyph_brush_layout, which fixes the layout bugs and adds a number of new layout options. Note that the &quot;Fira Sans&quot; font used in the example has some stylistic &quot;waviness&quot; ... this isn't a bug:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/text_layout.png" alt="text_layout" /></p>
<h2 id="renderer-optimization">Renderer Optimization</h2>
<div class="release-feature-authors">authors: @cart</div>
<p>Bevy's render api was built to be easy to use and extend. I wanted to nail down a good api first, but that resulted in a number of performance TODOs that caused some pretty serious overhead.</p>
<p>For <strong>Bevy 0.4</strong> I decided to resolve as many of those TODOs as I could. There is still plenty more to do (like instancing and batching), but Bevy already performs <em>much</em> better than it did before.</p>
<h3 id="incrementalize-everything">Incrementalize Everything</h3>
<p>Most of Bevy's high level render abstractions were designed to be incrementally updated, but when I was first building the engine, ECS change detection wasn't implemented. Now that we have all of these nice optimization tools, it makes sense to use them!</p>
<p>For the first optimization round, I incrementalized as much as I could:</p>
<ul>
<li>Added change detection to RenderResourceNode, Sprites, and Transforms, which improved performance when those values don't change</li>
<li>Only sync asset gpu data when the asset changes</li>
<li>Share asset RenderResourceBindings across all entities that reference an asset</li>
<li>Mesh provider system now only updates mesh specialization when it needs to</li>
<li>Stop clearing bind groups every frame and remove stale bind groups every other frame</li>
<li>Cache unmatched render resource binding results (which prevents redundant computations per-entity per-frame)</li>
<li>Don't send render pass state change commands when the state has not actually changed</li>
</ul>
<h4 id="frame-time-to-draw-10-000-static-sprites-in-milliseconds-less-is-better">Frame Time to Draw 10,000 Static Sprites (in milliseconds, less is better)</h4>
<p><img src="https://bevyengine.org/news/bevy-0-4/bevy_round1_static.svg" alt="bevy_round1_static" /></p>
<h4 id="frame-time-to-draw-10-000-moving-sprites-in-milliseconds-less-is-better">Frame Time to Draw 10,000 Moving Sprites (in milliseconds, less is better)</h4>
<p><img src="https://bevyengine.org/news/bevy-0-4/bevy_round1_dynamic.svg" alt="bevy_round1_dynamic" /></p>
<h3 id="optimize-text-rendering-and-other-immediate-rendering">Optimize Text Rendering (and other immediate rendering)</h3>
<p>Text Rendering (and anything else that used the <code>SharedBuffers</code> immediate-rendering abstraction) was <em>extremely</em> slow in prior Bevy releases. This was because the <code>SharedBuffers</code> abstraction was a placeholder implementation that didn't actually share buffers. By implementing the &quot;real&quot; <code>SharedBuffers</code> abstraction, we got a pretty significant text rendering speed boost.</p>
<h4 id="frame-time-to-draw-text-debug-example-in-milliseconds-less-is-better">Frame Time to Draw &quot;text_debug&quot; Example  (in milliseconds, less is better)</h4>
<p><img src="https://bevyengine.org/news/bevy-0-4/text_rendering.svg" alt="text_rendering" /></p>
<h3 id="mailbox-vsync">Mailbox Vsync</h3>
<p>Bevy now uses wgpu's &quot;mailbox vsync&quot; by default. This reduces input latency on platforms that support it.</p>
<h2 id="reflection">Reflection</h2>
<div class="release-feature-authors">authors: @cart</div>
<p>Rust has a pretty big &quot;reflection&quot; gap. For those who aren't aware, &quot;reflection&quot; is a class of language feature that enables you to interact with language constructs at runtime. They add a form of &quot;dynamic-ness&quot; to what are traditionally static language concepts. </p>
<p>We have bits and pieces of reflection in Rust, such as <a href="https:&#x2F;&#x2F;doc.rust-lang.org/stable&#x2F;std&#x2F;any/struct.TypeId.html"><code>std::any::TypeId</code>
</a> and <a href="https:&#x2F;&#x2F;doc.rust-lang.org/stable&#x2F;std&#x2F;any/fn.type_name.html"><code>std::any::type_name</code>
</a>. But when it comes to interacting with datatypes ... we don't have anything yet. This is unfortunate because some problems are inherently dynamic in nature.</p>
<p>When I was first building Bevy, I decided that the engine would benefit from such features. Reflection is a good foundation for scene systems, Godot-like (or Unity-like) property animation systems, and editor inspection tools. I built the <code>bevy_property</code> and <code>bevy_type_registry</code> crates to fill these needs.</p>
<p>They got the job done, but they were custom-tailored to Bevy's needs, were full of custom jargon (rather than reflecting Rust language constructs directly), didn't handle traits, and had a number of fundamental restrictions on how data could be accessed. </p>
<p>In this release we replaced the old <code>bevy_property</code> and <code>bevy_type_registry</code> crates with a new <a href="https:&#x2F;&#x2F;docs.rs/bevy_reflect&#x2F;0.4.0&#x2F;bevy_reflect/index.html"><code>bevy_reflect</code></a> crate. Bevy Reflect is intended to be a &quot;generic&quot; Rust reflection crate. I'm hoping it will be as useful for non-Bevy projects as it is for Bevy. We now use it for our Scene system, but in the future we will use it for animating Component fields and auto-generating Bevy Editor inspector widgets.</p>
<p>Bevy Reflect enables you to dynamically interact with Rust types by deriving the <a href="https:&#x2F;&#x2F;docs.rs/bevy_reflect&#x2F;0.4.0&#x2F;bevy_reflect/trait.Reflect.html"><code>Reflect</code>
</a> trait:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5fb3b3;">#[</span><span style="color:#cccece;">derive</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">Reflect</span><span style="color:#5fb3b3;">)]
</span><span style="color:#c594c5;">struct </span><span style="color:#cccece;">Foo </span><span style="color:#5fb3b3;">{
    </span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">: </span><span style="color:#c594c5;">u32</span><span style="color:#cccece;">,
    b</span><span style="color:#5fb3b3;">: </span><span style="color:#fac863;">Vec</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Bar</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">,
    c</span><span style="color:#5fb3b3;">: </span><span style="color:#fac863;">Vec</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#c594c5;">u32</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">,
</span><span style="color:#5fb3b3;">}

#[</span><span style="color:#cccece;">derive</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">Reflect</span><span style="color:#5fb3b3;">)]
</span><span style="color:#c594c5;">struct </span><span style="color:#cccece;">Bar </span><span style="color:#5fb3b3;">{
    </span><span style="color:#cccece;">value</span><span style="color:#5fb3b3;">:</span><span style="color:#cccece;"> String
</span><span style="color:#5fb3b3;">}

</span><span style="color:#5f6364;">// I&#39;ll use this value to illustrate `bevy_reflect` features
</span><span style="color:#c594c5;">let mut</span><span style="color:#cccece;"> foo </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> Foo </span><span style="color:#5fb3b3;">{
</span><span style="color:#cccece;">    a</span><span style="color:#5fb3b3;">: </span><span style="color:#f99157;">1</span><span style="color:#5fb3b3;">,
</span><span style="color:#cccece;">    b</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">vec!</span><span style="color:#5fb3b3;">[</span><span style="color:#cccece;">Bar </span><span style="color:#5fb3b3;">{</span><span style="color:#cccece;"> value</span><span style="color:#5fb3b3;">: &quot;</span><span style="color:#99c794;">hello world</span><span style="color:#5fb3b3;">&quot; }]
</span><span style="color:#cccece;">    c</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">vec!</span><span style="color:#5fb3b3;">[</span><span style="color:#f99157;">1</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">2</span><span style="color:#5fb3b3;">]
};
</span></code></pre><h3 id="interact-with-fields-using-their-names">Interact with Fields Using Their Names</h3>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">assert_eq!</span><span style="color:#5fb3b3;">(*</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">get_field</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#c594c5;">u32</span><span style="color:#5fb3b3;">&gt;(&quot;</span><span style="color:#99c794;">a</span><span style="color:#5fb3b3;">&quot;).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">(), </span><span style="color:#f99157;">1</span><span style="color:#5fb3b3;">);

*</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">get_field_mut</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#c594c5;">u32</span><span style="color:#5fb3b3;">&gt;(&quot;</span><span style="color:#99c794;">a</span><span style="color:#5fb3b3;">&quot;).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">() = </span><span style="color:#f99157;">2</span><span style="color:#5fb3b3;">;

</span><span style="color:#cccece;">assert_eq!</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">2</span><span style="color:#5fb3b3;">);
</span></code></pre><h3 id="patch-your-types-with-new-values">Patch Your Types With New Values</h3>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">let mut</span><span style="color:#cccece;"> dynamic_struct </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">DynamicStruct</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">();
</span><span style="color:#cccece;">dynamic_struct</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">insert</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">a</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#f99157;">42</span><span style="color:#c594c5;">u32</span><span style="color:#5fb3b3;">);
</span><span style="color:#cccece;">dynamic_struct</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">insert</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">c</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#cccece;">vec!</span><span style="color:#5fb3b3;">[</span><span style="color:#f99157;">3</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">4</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">5</span><span style="color:#5fb3b3;">]);

</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">apply</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">dynamic_struct</span><span style="color:#5fb3b3;">);

</span><span style="color:#cccece;">assert_eq!</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">a</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">42</span><span style="color:#5fb3b3;">);
</span><span style="color:#cccece;">assert_eq!</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">c</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">vec!</span><span style="color:#5fb3b3;">[</span><span style="color:#f99157;">3</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">4</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">5</span><span style="color:#5fb3b3;">]);
</span></code></pre><h3 id="look-up-nested-fields-using-path-strings">Look Up Nested Fields Using &quot;Path Strings&quot;</h3>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">let</span><span style="color:#cccece;"> value </span><span style="color:#5fb3b3;">= *</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">get_path</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#fac863;">String</span><span style="color:#5fb3b3;">&gt;(&quot;</span><span style="color:#99c794;">b[0].value</span><span style="color:#5fb3b3;">&quot;).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();
</span><span style="color:#cccece;">assert_eq!</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">value</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">as_str</span><span style="color:#5fb3b3;">(), &quot;</span><span style="color:#99c794;">hello world</span><span style="color:#5fb3b3;">&quot;);
</span></code></pre><h3 id="iterate-over-struct-fields">Iterate Over Struct Fields</h3>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">for </span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">i</span><span style="color:#5fb3b3;">,</span><span style="color:#cccece;"> value</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#cccece;">Reflect</span><span style="color:#5fb3b3;">) in</span><span style="color:#cccece;"> foo</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">iter_fields</span><span style="color:#5fb3b3;">().</span><span style="color:#6699cc;">enumerate</span><span style="color:#5fb3b3;">() {
    </span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> field_name </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> foo</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">name_at</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">i</span><span style="color:#5fb3b3;">).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();
    </span><span style="color:#c594c5;">if let </span><span style="color:#fac863;">Ok</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">value</span><span style="color:#5fb3b3;">) =</span><span style="color:#cccece;"> value</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">downcast_ref</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#c594c5;">u32</span><span style="color:#5fb3b3;">&gt;() {
        </span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">{} is a u32 with the value: {}</span><span style="color:#5fb3b3;">&quot;,</span><span style="color:#cccece;"> field_name</span><span style="color:#5fb3b3;">, *</span><span style="color:#cccece;">value</span><span style="color:#5fb3b3;">);
    } 
}
</span></code></pre><h3 id="automatically-serialize-and-deserialize-with-serde">Automatically Serialize And Deserialize With Serde</h3>
<p>This doesn't require manual Serde impls!</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#c594c5;">let mut</span><span style="color:#cccece;"> registry </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">TypeRegistry</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">();
</span><span style="color:#cccece;">registry</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">register</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#c594c5;">u32</span><span style="color:#5fb3b3;">&gt;();
</span><span style="color:#cccece;">registry</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">register</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#fac863;">String</span><span style="color:#5fb3b3;">&gt;();
</span><span style="color:#cccece;">registry</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">register</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#cccece;">Bar</span><span style="color:#5fb3b3;">&gt;();

</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> serializer </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">ReflectSerializer</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">, &amp;</span><span style="color:#cccece;">registry</span><span style="color:#5fb3b3;">);
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> serialized </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">ron</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">ser</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">to_string_pretty</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">serializer</span><span style="color:#5fb3b3;">, </span><span style="color:#cccece;">ron</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">ser</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">PrettyConfig</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">()).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();

</span><span style="color:#c594c5;">let mut</span><span style="color:#cccece;"> deserializer </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">ron</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">de</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">Deserializer</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">from_str</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">serialized</span><span style="color:#5fb3b3;">).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> reflect_deserializer </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">ReflectDeserializer</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">registry</span><span style="color:#5fb3b3;">);
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> value </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> reflect_deserializer</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">deserialize</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#c594c5;">mut</span><span style="color:#cccece;"> deserializer</span><span style="color:#5fb3b3;">).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> dynamic_struct </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> value</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">take</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#cccece;">DynamicStruct</span><span style="color:#5fb3b3;">&gt;().</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();

</span><span style="color:#5f6364;">/// reflect has its own partal_eq impl
</span><span style="color:#cccece;">assert!</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">foo</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">reflect_partial_eq</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#cccece;">dynamic_struct</span><span style="color:#5fb3b3;">).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">());
</span></code></pre><h3 id="trait-reflection">Trait Reflection</h3>
<p>You can now call a trait on a given <code>&amp;dyn Reflect</code> reference without knowing the underlying type! This is a form of magic that should probably be avoided in most situations. But in the few cases where it is completely necessary, it is very useful:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5fb3b3;">#[</span><span style="color:#cccece;">derive</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">Reflect</span><span style="color:#5fb3b3;">)]
#[</span><span style="color:#cccece;">reflect</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">DoThing</span><span style="color:#5fb3b3;">)]
</span><span style="color:#c594c5;">struct </span><span style="color:#cccece;">MyType </span><span style="color:#5fb3b3;">{
    </span><span style="color:#cccece;">value</span><span style="color:#5fb3b3;">:</span><span style="color:#cccece;"> String,
</span><span style="color:#5fb3b3;">}

</span><span style="color:#c594c5;">impl </span><span style="color:#cccece;">DoThing </span><span style="color:#c594c5;">for </span><span style="color:#cccece;">MyType </span><span style="color:#5fb3b3;">{
    </span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">do_thing</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#f99157;">self</span><span style="color:#5fb3b3;">) -&gt;</span><span style="color:#cccece;"> String </span><span style="color:#5fb3b3;">{
        </span><span style="color:#cccece;">format!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">{} World!</span><span style="color:#5fb3b3;">&quot;, </span><span style="color:#ec5f67;">self</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">value</span><span style="color:#5fb3b3;">)
    }
}

#[</span><span style="color:#cccece;">reflect_trait</span><span style="color:#5fb3b3;">]
</span><span style="color:#c594c5;">pub trait </span><span style="color:#cccece;">DoThing </span><span style="color:#5fb3b3;">{
    </span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">do_thing</span><span style="color:#5fb3b3;">(&amp;</span><span style="color:#f99157;">self</span><span style="color:#5fb3b3;">) -&gt;</span><span style="color:#cccece;"> String</span><span style="color:#5fb3b3;">;
}

</span><span style="color:#5f6364;">// First, lets box our type as a Box&lt;dyn Reflect&gt;
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> reflect_value</span><span style="color:#5fb3b3;">: </span><span style="color:#fac863;">Box</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">dyn Reflect</span><span style="color:#5fb3b3;">&gt; = </span><span style="color:#fac863;">Box</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">new</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">MyType </span><span style="color:#5fb3b3;">{
</span><span style="color:#cccece;">    value</span><span style="color:#5fb3b3;">: &quot;</span><span style="color:#99c794;">Hello</span><span style="color:#5fb3b3;">&quot;.</span><span style="color:#6699cc;">to_string</span><span style="color:#5fb3b3;">(),
});

</span><span style="color:#5f6364;">/* 
This means we no longer have direct access to MyType or it methods. We can only call Reflect methods on reflect_value. What if we want to call `do_thing` on our type? We could downcast using reflect_value.get::&lt;MyType&gt;(), but what if we don&#39;t know the type at compile time?
*/

// Normally in rust we would be out of luck at this point. Lets use our new reflection powers to do something cool!
</span><span style="color:#c594c5;">let mut</span><span style="color:#cccece;"> type_registry </span><span style="color:#5fb3b3;">= </span><span style="color:#cccece;">TypeRegistry</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">default</span><span style="color:#5fb3b3;">()
</span><span style="color:#cccece;">type_registry</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">register</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#cccece;">MyType</span><span style="color:#5fb3b3;">&gt;();

</span><span style="color:#5f6364;">/*
The #[reflect] attribute we put on our DoThing trait generated a new `ReflectDoThing` struct, which implements TypeData. This was added to MyType&#39;s TypeRegistration.
*/

</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> reflect_do_thing </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> type_registry
    </span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">get_type_data</span><span style="color:#5fb3b3;">::&lt;</span><span style="color:#cccece;">ReflectDoThing</span><span style="color:#5fb3b3;">&gt;(</span><span style="color:#cccece;">reflect_value</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">type_id</span><span style="color:#5fb3b3;">())
    .</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();

</span><span style="color:#5f6364;">// We can use this generated type to convert our `&amp;dyn Reflect` reference to an `&amp;dyn DoThing` reference
</span><span style="color:#c594c5;">let</span><span style="color:#cccece;"> my_trait</span><span style="color:#5fb3b3;">: &amp;</span><span style="color:#cccece;">dyn DoThing </span><span style="color:#5fb3b3;">=</span><span style="color:#cccece;"> reflect_do_thing</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">get</span><span style="color:#5fb3b3;">(&amp;*</span><span style="color:#cccece;">reflect_value</span><span style="color:#5fb3b3;">).</span><span style="color:#6699cc;">unwrap</span><span style="color:#5fb3b3;">();

</span><span style="color:#5f6364;">// Which means we can now call do_thing(). Magic!
</span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">{}</span><span style="color:#5fb3b3;">&quot;,</span><span style="color:#cccece;"> my_trait</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">do_thing</span><span style="color:#5fb3b3;">());
</span></code></pre><h2 id="3d-texture-assets">3D Texture Assets</h2>
<div class="release-feature-authors">authors: @bonsairobo</div>
<p>The Texture asset now has support for 3D textures. The new <code>array_texture.rs</code> example illustrates how to load a 3d texture and sample from each &quot;layer&quot;.</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/array_texture.png" alt="array_texture" /></p>
<h2 id="logging-and-profiling">Logging and Profiling</h2>
<div class="release-feature-authors">authors: @superdump, @cart</div>
<p>Bevy finally has built in logging, which is now enabled by default via the new <a href="https:&#x2F;&#x2F;docs.rs/bevy_log&#x2F;0.4.0&#x2F;bevy_log/struct.LogPlugin.html"><code>LogPlugin</code>
</a>. We evaluated various logging libraries and eventually landed on the new <code>tracing</code> crate. <code>tracing</code> is a structured logger that handles async / parallel logging well (perfect for an engine like Bevy), and enables profiling in addition to &quot;normal&quot; logging.</p>
<p>The <a href="https:&#x2F;&#x2F;docs.rs/bevy_log&#x2F;0.4.0&#x2F;bevy_log/struct.LogPlugin.html"><code>LogPlugin</code>
</a> configures each platform to log to the appropriate backend by default: the terminal on desktop, the console on web, and Android Logs / logcat on Android. We built a new Android <code>tracing</code> backend because one didn't exist yet.</p>
<h3 id="logging">Logging</h3>
<p>Bevy's internal plugins now generate <code>tracing</code> logs. And you can easily add logs to your own app logic like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#5f6364;">// these are imported by default in bevy::prelude::*
</span><span style="color:#cccece;">trace!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">very noisy</span><span style="color:#5fb3b3;">&quot;);
</span><span style="color:#cccece;">debug!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">helpful for debugging</span><span style="color:#5fb3b3;">&quot;);
</span><span style="color:#cccece;">info!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">helpful information that is worth printing by default</span><span style="color:#5fb3b3;">&quot;);
</span><span style="color:#cccece;">warn!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">something bad happened that isn&#39;t a failure, but thats worth calling out</span><span style="color:#5fb3b3;">&quot;);
</span><span style="color:#cccece;">error!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">something failed</span><span style="color:#5fb3b3;">&quot;);
</span></code></pre>
<p>These lines result in pretty-printed terminal logs:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/logs.png" alt="logs" /></p>
<p><code>tracing</code> has a ton of useful features like structured logging and filtering. <a href="https://docs.rs/tracing/*/tracing/">Check out their documentation for more info.</a></p>
<h3 id="profiling">Profiling</h3>
<p>We have added the option to add &quot;tracing spans&quot; to all ECS systems by enabling the <code>trace</code> feature. We also have built in support for the <code>tracing-chrome</code> extension, which causes Bevy to output traces in the &quot;chrome tracing&quot; format.</p>
<p>If you run your app with <code>cargo run --features bevy/trace,bevy/trace_chrome</code> you will get a json file which can be opened in Chrome browsers by visiting the <code>chrome://tracing</code> url:</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/profiling.png" alt="profiling" /></p>
<p>@superdump added support for those nice &quot;span names&quot; to upstream <code>tracing_chrome</code>.</p>
<h2 id="hidpi">HIDPI</h2>
<div class="release-feature-authors">authors: @mockersf, @blunted2night, @cart</div>
<p>Bevy now handles HIDPI / Retina / high pixel density displays properly:</p>
<ul>
<li>OS-reported pixel density is now taken into account when creating windows. If a Bevy App asks for a 1280x720 window on a 2x pixel density display, it will create a window that is 2560x1440</li>
<li>Window width/height is now reported in &quot;logical units&quot; (1280x720 in the example above). Physical units are still available using the <code>window.physical_width()</code> and <code>window.physical_height()</code> methods.</li>
<li>Window &quot;swap chains&quot; are created using the physical resolution to ensure we still have crisp rendering (2560x1440 in the example above) </li>
<li>Bevy UI has been adapted to handle HIDPI scaling correctly</li>
</ul>
<p>There is still a bit more work to be done here. While Bevy UI renders images and boxes at crisp HIDPI resolutions, text is still rendered using the logical resolution, which means it won't be as crisp as it could be on HIDPI displays.</p>
<h2 id="timer-improvements">Timer Improvements</h2>
<div class="release-feature-authors">authors: @amberkowalski, @marcusbuffett, @CleanCut</div>
<p>Bevy's Timer component/resource got a number of quality-of-life improvements: pausing, field accessor methods, ergonomics improvements, and internal refactoring / code quality improvements. Timer Components also no longer tick by default. Timer resources and newtyped Timer components couldn't tick by default, so it was a bit inconsistent to have the (relatively uncommon) &quot;unwrapped component Timer&quot; auto-tick.</p>
<p>The timer api now looks like this:</p>
<pre style="background-color:#2b2c2f;">
<code class="language-rust" data-lang="rust"><span style="color:#cccece;">
</span><span style="color:#c594c5;">struct </span><span style="color:#cccece;">MyTimer </span><span style="color:#5fb3b3;">{
    </span><span style="color:#cccece;">timer</span><span style="color:#5fb3b3;">:</span><span style="color:#cccece;"> Timer,
</span><span style="color:#5fb3b3;">}

</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">() {
    </span><span style="color:#cccece;">App</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">build</span><span style="color:#5fb3b3;">()
        .</span><span style="color:#6699cc;">add_resource</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">MyTimer </span><span style="color:#5fb3b3;">{
            </span><span style="color:#5f6364;">// a five second non-repeating timer
</span><span style="color:#cccece;">            timer</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Timer</span><span style="color:#5fb3b3;">::</span><span style="color:#cccece;">from_seconds</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">5.0</span><span style="color:#5fb3b3;">, </span><span style="color:#f99157;">false</span><span style="color:#5fb3b3;">),
        })
        .</span><span style="color:#6699cc;">add_system</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">timer_system</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">system</span><span style="color:#5fb3b3;">())
        .</span><span style="color:#6699cc;">run</span><span style="color:#5fb3b3;">();
}


</span><span style="color:#c594c5;">fn </span><span style="color:#6699cc;">timer_system</span><span style="color:#5fb3b3;">(</span><span style="color:#f99157;">time</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">Res</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">Time</span><span style="color:#5fb3b3;">&gt;</span><span style="color:#cccece;">, </span><span style="color:#f99157;">my_timer</span><span style="color:#5fb3b3;">: </span><span style="color:#cccece;">ResMut</span><span style="color:#5fb3b3;">&lt;</span><span style="color:#cccece;">MyTimer</span><span style="color:#5fb3b3;">&gt;) {
    </span><span style="color:#c594c5;">if</span><span style="color:#cccece;"> my_timer</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">timer</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">tick</span><span style="color:#5fb3b3;">(</span><span style="color:#cccece;">time</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">delta_seconds</span><span style="color:#5fb3b3;">()).</span><span style="color:#6699cc;">just_finished</span><span style="color:#5fb3b3;">() {
        </span><span style="color:#cccece;">println!</span><span style="color:#5fb3b3;">(&quot;</span><span style="color:#99c794;">five seconds have passed</span><span style="color:#5fb3b3;">&quot;);
    }
}
</span></code></pre><h2 id="task-system-improvements">Task System Improvements</h2>
<div class="release-feature-authors">authors: @aclysma</div>
<p>@aclysma changed how Bevy Tasks schedules work, which increased performance in the <code>breakout.rs</code> example game by <b style="color: rgb(50, 210, 50)">~20%</b> and resolved a <a href="https://github.com/bevyengine/bevy/pull/892">deadlock</a> when a Task Pool is configured to only have one thread. Tasks are now executed on the calling thread immediately when there is only one task to run, which cuts down on the overhead of moving work to other threads / blocking on them to finish.</p>
<h2 id="apple-silicon-support">Apple Silicon Support</h2>
<div class="release-feature-authors">authors: @frewsxcv, @wyhaya, @scoopr</div>
<p>Bevy now runs on Apple silicon thanks to upstream work on winit (@scoopr) and coreaudio-sys (@wyhaya). @frewsxcv and @wyhaya updated Bevy's dependencies and verified that it builds/runs on Apple's new chips.</p>
<h2 id="new-examples">New Examples</h2>
<h3 id="contributors">Contributors</h3>
<div class="release-feature-authors">author: @karroffel</div>
<p>@karroffel added a fun example that represents each Bevy contributor as a &quot;Bevy Bird&quot;. It scrapes the latest contributor list from git.</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/contributors.png" alt="contributors" /></p>
<h3 id="bevymark">BevyMark</h3>
<div class="release-feature-authors">author: @robdavenport</div>
<p>A &quot;bunnymark-style&quot; benchmark illustrating Bevy's sprite rendering performance. This was useful when implementing the renderer optimizations mentioned above.</p>
<p><img src="https://bevyengine.org/news/bevy-0-4/bevymark.png" alt="bevymark" /></p>
<h2 id="change-log">Change Log</h2>
<h3 id="added">Added</h3>
<ul>
<li><a href="https://github.com/bevyengine/bevy/pull/273">add bevymark benchmark example</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/772">gltf: support camera and fix hierarchy</a> </li>
<li><a href="https://github.com/bevyengine/bevy/pull/789">Add tracing spans to schedules, stages, systems</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/801">add example that represents contributors as bevy icons</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/805">Add received character</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/808">Add bevy_dylib to force dynamic linking of bevy</a> </li>
<li><a href="https://github.com/bevyengine/bevy/pull/815">Added RenderPass::set_scissor_rect</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/836"><code>bevy_log</code></a>
<ul>
<li>Adds logging functionality as a Plugin.</li>
<li>Changes internal logging to work with the new implementation.</li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/847">cross-platform main function</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/852">Controllable ambient light color</a>
<ul>
<li>Added a resource to change the current ambient light color for PBR.</li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/859">Added more basic color constants</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/883">Add box shape</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/894">Expose an EventId for events</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/876">System Inputs, Outputs, and Chaining</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/894">Expose an <code>EventId</code> for events</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/917">Added <code>set_cursor_position</code> to <code>Window</code></a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/926">Added new Bevy reflection system</a>
<ul>
<li>Replaces the properties system</li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/928">Add support for Apple Silicon</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/937">Live reloading of shaders</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/940"> Store mouse cursor position in Window</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/945">Add removal_detection example</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/946">Additional vertex attribute value types</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/956">Added WindowFocused event</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/979">Tracing chrome span names</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1004">Allow windows to be maximized</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1016">GLTF: load default material</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1026">can spawn a scene from a ChildBuilder, or directly set its parent when spawning it</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1038">add ability to load <code>.dds</code>, <code>.tga</code>, and <code>.jpeg</code> texture formats</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1037">add ability to provide custom a <code>AssetIo</code> implementation</a></li>
</ul>
<h3 id="changed">Changed</h3>
<ul>
<li><a href="https://github.com/bevyengine/bevy/pull/691">delegate layout reflection to RenderResourceContext</a> </li>
<li><a href="https://github.com/bevyengine/bevy/pull/719">Fall back to remove components one by one when failing to remove a bundle</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/761">Port hecs derive macro improvements</a> </li>
<li><a href="https://github.com/bevyengine/bevy/pull/765">Use glyph_brush_layout and add text alignment support</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/791">upgrade glam and hexasphere</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/798">Flexible ECS Params</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/820">Make Timer.tick return &amp;Self</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/821">FileAssetIo includes full path on error</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/829">Removed ECS query APIs that could easily violate safety from the public interface</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/834">Changed Query filter API to be easier to understand</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/842">bevy_render: delegate buffer aligning to render_resource_context</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/843">wasm32: non-spirv shader specialization</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/863">Renamed XComponents to XBundle</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/864">Check for conflicting system resource parameters</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/887">Tweaks to TextureAtlasBuilder.finish()</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/893">do not spend time drawing text with is_visible = false</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/903">Extend the Texture asset type to support 3D data</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/914">Breaking changes to timer API</a>
<ul>
<li>Created getters and setters rather than exposing struct members.</li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/931">Removed timer auto-ticking system</a>
<ul>
<li>Added an example of how to tick timers manually.</li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/932">When a task scope produces &lt;= 1 task to run, run it on the calling thread immediately</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/934">Breaking changes to Time API</a>
<ul>
<li>Created getters to get <code>Time</code> state and made members private.</li>
<li>Modifying <code>Time</code>'s values directly is no longer possible outside of bevy.</li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/920">Use <code>mailbox</code> instead of <code>fifo</code> for vsync on supported systems</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/947">switch winit size to logical to be dpi independent</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/952">Change bevy_input::Touch API to match similar APIs</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/955">Run parent-update and transform-propagation during the &quot;post-startup&quot; stage (instead of &quot;startup&quot;)</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/958">Renderer Optimization Round 1</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/969">Change<code>TextureAtlasBuilder</code> into expected Builder conventions</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/972">Optimize Text rendering / SharedBuffers</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/973">hidpi swap chains</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/987">optimize asset gpu data transfer</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/995">naming coherence for cameras</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1021">Schedule v2</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1027">Use shaderc for aarch64-apple-darwin</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1033">update <code>Window</code>'s <code>width</code> &amp; <code>height</code> methods to return <code>f32</code></a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1034">Break out Visible component from Draw</a>
<ul>
<li>Users setting <code>Draw::is_visible</code> or <code>Draw::is_transparent</code> should now set <code>Visible::is_visible</code> and <code>Visible::is_transparent</code></li>
</ul>
</li>
<li><a href="https://github.com/bevyengine/bevy/pull/1043"><code>winit</code> upgraded from version 0.23 to version 0.24</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1071">set is_transparent to true by default for UI bundles</a></li>
</ul>
<h3 id="fixed">Fixed</h3>
<ul>
<li><a href="https://github.com/bevyengine/bevy/pull/857">Fixed typos in KeyCode identifiers</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/871">Remove redundant texture copies in TextureCopyNode</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/892">Fix a deadlock that can occur when using scope() on ComputeTaskPool from within a system</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/893">Don't draw text that isn't visible</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/895">Use <code>instant::Instant</code> for WASM compatibility</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/897">Fix pixel format conversion in bevy_gltf</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/904">Fixed duplicated children when spawning a Scene</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/905">Corrected behaviour of the UI depth system</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/908">Allow despawning of hierarchies in threadlocal systems</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/948">Fix <code>RenderResources</code> index slicing</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/955">Run parent-update and transform-propagation during the &quot;post-startup&quot; stage</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/966">Fix collision detection by comparing abs() penetration depth</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/997">deal with rounding issue when creating the swap chain</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1023">only update components for entities in map</a></li>
<li><a href="https://github.com/bevyengine/bevy/pull/1035">Don't panic when attempting to set shader defs from an asset that hasn't loaded yet</a></li>
</ul>
<h2 id="contributors-1">Contributors</h2>
<p>A huge thanks to the <strong>66 contributors</strong> that made this release (and associated docs) possible!</p>
<ul>
<li>@0x6273</li>
<li>@aclysma</li>
<li>@ak-1</li>
<li>@alec-deason</li>
<li>@AlisCode</li>
<li>@amberkowalski</li>
<li>@bjorn3</li>
<li>@blamelessgames</li>
<li>@blunted2night</li>
<li>@bonsairobo</li>
<li>@cart</li>
<li>@CleanCut</li>
<li>@ColdIce1605</li>
<li>@dallenng</li>
<li>@e00E</li>
<li>@easynam</li>
<li>@frewsxcv</li>
<li>@FuriouZz</li>
<li>@Git0Shuai</li>
<li>@iMplode-nZ</li>
<li>@iwikal</li>
<li>@jcornaz</li>
<li>@Jerald</li>
<li>@joshuajbouw</li>
<li>@julhe</li>
<li>@karroffel</li>
<li>@Keats</li>
<li>@Kurble</li>
<li>@lassade</li>
<li>@lukors</li>
<li>@marcusbuffett</li>
<li>@marius851000</li>
<li>@memoryruins</li>
<li>@MGlolenstine</li>
<li>@milkybit</li>
<li>@MinerSebas</li>
<li>@mkhan45</li>
<li>@mockersf</li>
<li>@Moxinilian</li>
<li>@mrk-its</li>
<li>@mvlabat</li>
<li>@nic96</li>
<li>@no1hitjam</li>
<li>@octtep</li>
<li>@OptimisticPeach</li>
<li>@Plecra</li>
<li>@PrototypeNM1</li>
<li>@rmsthebest</li>
<li>@RobDavenport</li>
<li>@robertwayne</li>
<li>@rod-salazar</li>
<li>@sapir</li>
<li>@sburris0</li>
<li>@sdfgeoff</li>
<li>@shirshak55</li>
<li>@smokku</li>
<li>@steveyen</li>
<li>@superdump</li>
<li>@SvenTS</li>
<li>@tangmi</li>
<li>@thebluefish</li>
<li>@Tiagojdferreira</li>
<li>@tigregalis</li>
<li>@toothbrush7777777</li>
<li>@Veykril</li>
<li>@yrns</li>
</ul>
</div>
</div>

            </div>
        </section>
    </body>
</html>
